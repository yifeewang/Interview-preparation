## 浏览器是多进程的

它主要包括以下进程：

1. Browser 进程：浏览器的主进程，唯一，负责创建和销毁其它进程、网络资源的下载与管理、浏览器界面的展示、前进后退等。

2. GPU 进程：用于 3D 绘制等，最多一个。

3. 第三方插件进程：每种类型的插件对应一个进程，仅当使用该插件时才创建。

4. 浏览器渲染进程（浏览器内核）：内部是多线程的，每打开一个新网页就会创建一个进程，主要用于页面渲染，脚本执行，事件处理等。

## 渲染进程（浏览器内核）

浏览器的渲染进程是多线程的，页面的渲染，JavaScript 的执行，事件的循环，都在这个进程内进行：

`GUI 渲染线程`：负责渲染浏览器界面，当界面需要重绘（Repaint）或由于某种操作引发回流(Reflow)时，该线程就会执行。

`JavaScript 引擎线程`：也称为 JavaScript 内核，负责处理 Javascript 脚本程序、解析 Javascript 脚本、运行代码等。（例如 V8 引擎）

`事件触发线程`：用来控制浏览器事件循环，注意这不归 JavaScript 引擎线程管，当事件被触发时，该线程会把事件添加到待处理队列的队尾，等待 JavaScript 引擎的处理。

`定时触发器线程`：传说中的 setInterval 与 setTimeout 所在线程，注意，W3C 在 HTML 标准中规定，规定要求 setTimeout 中低于 4ms 的时间间隔算为 4ms 。（PS：最小间隔4ms的说法是不准确的，或者说是有前提条件的，请看HTML标准：11. If nesting level is greater than 5, and timeout is less than 4, then set timeout to 4.，也就是说，循环嵌套超过5层的，并且延迟不到4ms，才会变成4ms）

`异步 http 请求线程`：在 XMLHttpRequest 连接后通过浏览器新开一个线程请求，将检测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件，将这个回调再放入事件队列中。再由 JavaScript 引擎执行。

注意，GUI 渲染线程与 JavaScript 引擎线程是互斥的，当 JavaScript 引擎执行时 GUI 线程会被挂起（相当于被冻结了），GUI 更新会被保存在一个队列中等到 JavaScript 引擎空闲时立即被执行。所以如果 JavaScript 执行的时间过长，这样就会造成页面的渲染不连贯，导致页面渲染加载阻塞。

## 单线程的 JavaScript
所谓单线程，是指在 JavaScript 引擎中负责解释和执行 JavaScript 代码的线程唯一，同一时间上只能执行一件任务。

## v8
V8是JavaScript引擎，由Google开发，用于Google Chrome和Node.js等应用中。它采用了即时编译（JIT）技术，能够快速地将JavaScript代码翻译成机器码执行。下面是V8的一些原理：

`抽象语法树（AST）`：V8将JavaScript代码解析成抽象语法树（AST），这使得代码的分析和优化变得更加容易。

`编译器`：V8中有一个即时编译器（JIT Compiler）和一个解释器，它们一起工作来解释和编译JavaScript代码。当V8执行JavaScript代码时，解释器首先将其转换为字节码并运行。当V8确定哪些代码是最热门的时，即时编译器会编译这些代码成本地机器码，从而提高性能。

`内存管理`：V8采用了使用堆内存的方式来存储JavaScript对象。内存管理方面，V8使用了基于分代回收算法的垃圾回收策略，即将对象根据其生命周期划分为不同的代，并分别采用不同的垃圾回收算法来进行管理。

`单线程执行`：JavaScript本身是单线程的语言，在V8中也是如此。V8通过事件循环机制（Event Loop）来模拟异步执行，同时采用了一些优化技术，如Promise/Async-Await等，来提高JavaScript代码的处理效率。

`JIT编译优化`：为了提高JavaScript代码的执行效率，V8采用了一些优化技术，如“内联缓存”（Inline Cache）、“隐藏类”（Hidden Class）和“方法内联”（Method Inlining）等，以此改善代码执行时的访问速度和处理效率。

`内置库`：V8不仅包含JavaScript解释器和编译器，还包含了一些内置的JavaScript库，如数组、字符串等，这些库是使用C++编写的，并通过JavaScript API对外提供服务。

下面是V8的工作流程：

`解析`：当浏览器或Node.js收到JavaScript代码时，V8将其解析成抽象语法树（AST），这是V8分析和操作JavaScript代码的基础。

`编译`：V8利用即时编译（JIT）技术将JavaScript代码转换为机器码以便更快地执行。V8中有两个主要的编译器：解释器（Interpreter）和即时编译器（JIT Compiler）。

`优化`：V8采用了一系列的优化策略，例如将较小的函数内联、使用隐藏类来优化属性访问等，以此来提升JavaScript代码的执行效率。

`执行`：一旦JavaScript代码被编译为机器码，V8会将其加载到内存中并执行。

`垃圾回收`：由于JavaScript使用堆内存来存储对象，所以V8采用了基于分代垃圾回收算法的策略来管理内存。V8将对象分为不同的代，采用不同的回收算法来回收各代内的垃圾对象，并定期执行全局垃圾回收。

`内置库`：V8中还包含了一些内置的JavaScript库，例如数组、字符串等。这些库是使用C++编写，通过JavaScript API对外提供服务。

总体来说，V8的工作流程涵盖了解析、编译、优化、执行和垃圾回收等关键步骤。通过这些步骤，V8能够将JavaScript代码转换为机器码并快速执行，同时还采用了垃圾回收算法和内置库等技术，以提高JavaScript代码的执行效率和可靠性。